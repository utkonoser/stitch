# Пайплайн конвертации изображений в формат вышивки

Этот проект предоставляет полный пайплайн для конвертации изображений в формат вышивки DST через промежуточный SVG формат.

## Архитектура

```
PNG/JPEG/BMP/TIFF → PBM → SVG → DST
     ↑              ↑      ↑
  ImageMagick    Potrace  svg_to_dst.py
```

## Компоненты

### 1. Potrace (трассировка контуров)
Конвертирует растровые изображения в SVG путем извлечения контуров.

**Возможности:**
- Поддержка PNG, JPEG, BMP, TIFF
- Автоматическое обнаружение контуров
- Высокое качество трассировки

### 2. Python конвертер (svg_to_dst/)
Конвертирует SVG файлы в формат вышивки DST с поддержкой заливки.

**Возможности:**
- Использует pyembroidery и svgelements
- Поддержка различных форматов вышивки
- Автоматическая генерация заливки для замкнутых контуров
- Настраиваемый тип заливки (none, parallel)
- Настраиваемое расстояние между линиями заливки

### 3. Пайплайн (pipeline.sh)
Объединяет все компоненты в единый процесс.

## Установка

### 1. Установка зависимостей
```bash
make setup
```

Или вручную:
```bash
# Установка potrace и imagemagick
make install-deps

# Настройка Python окружения
make setup-python
```

### 2. Настройка пайплайна
```bash
chmod +x pipeline.sh
```

## Использование

### Базовое использование
```bash
source venv_pipeline/bin/activate
./pipeline.sh image.png
```

### С заливкой
```bash
./pipeline.sh image.png --fill-type parallel --fill-spacing 2.0
```

### С настройками
```bash
./pipeline.sh image.png -o output.dst --keep-svg
```

### Сохранение промежуточного SVG
```bash
./pipeline.sh image.png --keep-svg
```

## Параметры пайплайна

- `-o, --output FILE` - выходной DST файл
- `--keep-svg` - сохранить промежуточный SVG файл
- `--fill-type TYPE` - тип заливки: none, parallel (по умолчанию: none)
- `--fill-spacing N` - расстояние между линиями заливки (по умолчанию: 2.0)
- `-h, --help` - показать справку

## Примеры

### Простая конвертация
```bash
./pipeline.sh pictures/rabbit.png
```

### Конвертация с заливкой
```bash
./pipeline.sh pictures/rabbit.png --fill-type parallel --fill-spacing 3.0
```

### Конвертация с сохранением SVG
```bash
./pipeline.sh pictures/rabbit.png --keep-svg
```

## Структура проекта

```
stitch/
├── svg_to_dst/             # Python конвертер
│   └── svg_to_dst.py       # Конвертер SVG→DST с заливкой
├── pictures/               # Тестовые изображения
│   └── rabbit.png
├── pipeline.sh             # Основной пайплайн
├── Makefile                # Автоматизация установки
├── venv_pipeline/          # Виртуальное окружение для пайплайна
└── README.md               # Этот файл
```

## Требования

- potrace
- imagemagick
- Python 3.11+
- pyembroidery
- svgelements

## Ограничения

- Работает лучше всего с изображениями с четкими контурами
- Для сложных изображений может потребоваться настройка параметров
- Цветная информация теряется (конвертируется в черно-белое)
- Заливка работает только для замкнутых контуров

## Результат

Пайплайн создает файл вышивки в формате DST, который можно использовать на вышивальных машинах. При включенной заливке замкнутые области будут заполнены параллельными линиями стежков. 