# Пайплайн конвертации изображений в формат вышивки

Этот проект предоставляет полный пайплайн для конвертации изображений в формат вышивки DST через промежуточный SVG формат.

## Архитектура

```
PNG/JPEG/BMP/TIFF → PBM → SVG → DST
     ↑              ↑      ↑
  ImageMagick    Potrace  svg_to_dst.py
```

## Компоненты

### 1. Potrace (трассировка контуров)
Конвертирует растровые изображения в SVG путем извлечения контуров.

**Возможности:**
- Поддержка PNG, JPEG, BMP, TIFF
- Автоматическое обнаружение контуров
- Высокое качество трассировки

### 2. Python конвертер (svg_to_dst.py)
Конвертирует SVG файлы в формат вышивки DST.

**Возможности:**
- Использует pyembroidery и svgelements
- Поддержка различных форматов вышивки
- Позволяет управлять толщиной линии и шагом дискретизации

### 3. Пайплайн (pipeline.sh)
Объединяет все компоненты в единый процесс.

## Установка

### 1. Установка зависимостей
```bash
make setup
```

Или вручную:
```bash
# Установка potrace и imagemagick
make install-deps

# Настройка Python окружения
make setup-python
```

### 2. Настройка пайплайна
```bash
chmod +x pipeline.sh
```

## Использование

### Базовое использование
```bash
source venv_pipeline/bin/activate
./pipeline.sh image.png
```

### С увеличенной толщиной линии
```bash
./pipeline.sh image.png --contour-width 3
```

### С уменьшенным шагом дискретизации
```bash
./pipeline.sh image.png --contour-step 1.0
```

### Сохранение промежуточного SVG
```bash
./pipeline.sh image.png --keep-svg
```

## Параметры пайплайна

- `-o, --output FILE` - выходной DST файл
- `--keep-svg` - сохранить промежуточный SVG файл
- `--contour-step N` - шаг дискретизации path (по умолчанию: 2.0)
- `--contour-width N` - ширина линии (количество параллельных линий, по умолчанию: 1)
- `-h, --help` - показать справку

## Примеры

### Простая конвертация
```bash
./pipeline.sh pictures/rabbit.png
```

### С увеличенной толщиной линии
```bash
./pipeline.sh pictures/rabbit.png --contour-width 3
```

### С уменьшенным шагом дискретизации
```bash
./pipeline.sh pictures/rabbit.png --contour-step 1.0
```

### Конвертация с сохранением SVG
```bash
./pipeline.sh pictures/rabbit.png --keep-svg
```

## Структура проекта

```
stitch/
├── svg_to_dst.py       # Конвертер SVG→DST
├── pictures/               # Тестовые изображения
├── pipeline.sh             # Основной пайплайн
├── Makefile                # Автоматизация установки
├── venv_pipeline/          # Виртуальное окружение для пайплайна
└── README.md               # Этот файл
```

## Требования

- potrace
- imagemagick
- Python 3.11+
- pyembroidery
- svgelements

## Ограничения

- Работает лучше всего с изображениями с четкими контурами
- Для сложных изображений может потребоваться настройка параметров
- Цветная информация теряется (конвертируется в черно-белое)
- Заливка областей не поддерживается, только контуры

## Результат

Пайплайн создает файл вышивки в формате DST, который можно использовать на вышивальных машинах. Контуры изображения будут переведены в линии стежков с заданной толщиной и дискретизацией. 